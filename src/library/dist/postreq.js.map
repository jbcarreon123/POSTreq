{"version":3,"file":"postreq.js","sources":["../src/iframe.ts","../src/index.ts"],"sourcesContent":["import type { MessageRequest } from \"./shared.js\";\n\nexport class POSTreq_Iframe {\n    constructor() {\n        console.log('POSTreq loaded. https://postreq.jbc.lol/');\n        window.addEventListener('message', async (e) => {\n            if (!e.data.url) return;\n            const evt = e as MessageEvent<MessageRequest>;\n            let p = document.querySelector('p.debug');\n            if (p) p.textContent = JSON.stringify(evt);\n            try {\n                const data = evt.data as MessageRequest;\n                const res = await fetch(data.url, data.req);\n                const headers = {};\n                res.headers.forEach((value, name) => {\n                    //@ts-ignore\n                    headers[name] = value;\n                });\n\n                let json: string | undefined;\n                try {\n                    json = await res.clone().json();\n                } catch {}\n\n                let arrayBuffer: ArrayBuffer | undefined = undefined;\n                try {\n                    arrayBuffer = await res.clone().arrayBuffer()\n                } catch {}\n\n                let blob: Blob | undefined;\n                try {\n                    blob = await res.clone().blob();\n                } catch {}\n\n                let formData: FormData | undefined;\n                try {\n                    formData = await res.clone().formData();\n                } catch {}\n\n                let text: string | undefined;\n                try {\n                    text = await res.clone().text()\n                } catch {}\n\n                const payload = {\n                    status: res.status,\n                    statusText: res.statusText,\n                    headers: headers,\n                    json,\n                    arrayBuffer,\n                    formData,\n                    blob,\n                    text,\n                    ok: res.ok\n                };\n                if (p) p.textContent = JSON.stringify(payload);\n                evt.source?.postMessage(payload);\n            } catch (e) {\n                console.log(e);\n                evt.source?.postMessage({\n                    error: e\n                });\n            }\n        })\n    }\n}\n","import type { MessageRequest, MessageResponse } from \"./shared.js\";\nexport { POSTreq_Iframe } from './iframe.js';\n\nexport class POSTreq {\n    _iframe: HTMLIFrameElement;\n    _url?: string;\n\n    constructor(params?: {style?: string, url?: string, parentElement?: HTMLElement}) {\n        this._url = params?.url || \"https://postreq.jbc.lol/postreq\"; \n        this._iframe = document.createElement('iframe');\n        if (!params?.style) this._iframe.style.display = \"none\";\n        else this._iframe.style = params?.style;\n        this._iframe.src = this._url;\n        (params?.parentElement ?? document.body).appendChild(this._iframe);\n    }\n\n    private async onMessage(): Promise<MessageEvent<MessageResponse>> {\n        // @ts-ignore\n        return new Promise(resolve => window.onmessage = (e: MessageEvent<MessageResponse>) => {\n            if (e.origin !== this._url)\n            return resolve(e)\n        });\n    }\n\n    async fetch(url: string, req?: RequestInit): Promise<MessageResponse | null> {\n        if (url.includes('undefined')) return null;\n        const obj: MessageRequest = {\n            url,\n            req\n        }\n        this._iframe.contentWindow?.postMessage(obj);\n        const res = await this.onMessage();\n        return res.data;\n    }\n}"],"names":[],"mappings":";;;;;;UAEa,cAAc,CAAA;IACvB,IAAA,WAAA,GAAA;IACI,QAAA,OAAO,CAAC,GAAG,CAAC,0CAA0C,CAAC;YACvD,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,KAAI;IAC3C,YAAA,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG;oBAAE;gBACjB,MAAM,GAAG,GAAG,CAAiC;gBAC7C,IAAI,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAC;IACzC,YAAA,IAAI,CAAC;oBAAE,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;IAC1C,YAAA,IAAI;IACA,gBAAA,MAAM,IAAI,GAAG,GAAG,CAAC,IAAsB;IACvC,gBAAA,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC;oBAC3C,MAAM,OAAO,GAAG,EAAE;oBAClB,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,IAAI,KAAI;;IAEhC,oBAAA,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK;IACzB,gBAAA,CAAC,CAAC;IAEF,gBAAA,IAAI,IAAwB;IAC5B,gBAAA,IAAI;wBACA,IAAI,GAAG,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE;oBACnC;oBAAE,MAAM,EAAC;oBAET,IAAI,WAAW,GAA4B,SAAS;IACpD,gBAAA,IAAI;wBACA,WAAW,GAAG,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC,WAAW,EAAE;oBACjD;oBAAE,MAAM,EAAC;IAET,gBAAA,IAAI,IAAsB;IAC1B,gBAAA,IAAI;wBACA,IAAI,GAAG,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE;oBACnC;oBAAE,MAAM,EAAC;IAET,gBAAA,IAAI,QAA8B;IAClC,gBAAA,IAAI;wBACA,QAAQ,GAAG,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC,QAAQ,EAAE;oBAC3C;oBAAE,MAAM,EAAC;IAET,gBAAA,IAAI,IAAwB;IAC5B,gBAAA,IAAI;wBACA,IAAI,GAAG,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC,IAAI,EAAE;oBACnC;oBAAE,MAAM,EAAC;IAET,gBAAA,MAAM,OAAO,GAAG;wBACZ,MAAM,EAAE,GAAG,CAAC,MAAM;wBAClB,UAAU,EAAE,GAAG,CAAC,UAAU;IAC1B,oBAAA,OAAO,EAAE,OAAO;wBAChB,IAAI;wBACJ,WAAW;wBACX,QAAQ;wBACR,IAAI;wBACJ,IAAI;wBACJ,EAAE,EAAE,GAAG,CAAC;qBACX;IACD,gBAAA,IAAI,CAAC;wBAAE,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;IAC9C,gBAAA,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC;gBACpC;gBAAE,OAAO,CAAC,EAAE;IACR,gBAAA,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;IACd,gBAAA,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC;IACpB,oBAAA,KAAK,EAAE;IACV,iBAAA,CAAC;gBACN;IACJ,QAAA,CAAC,CAAC;QACN;IACH;;UC9DY,OAAO,CAAA;IAChB,IAAA,OAAO;IACP,IAAA,IAAI;IAEJ,IAAA,WAAA,CAAY,MAAoE,EAAA;YAC5E,IAAI,CAAC,IAAI,GAAG,MAAM,EAAE,GAAG,IAAI,iCAAiC;YAC5D,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC;YAC/C,IAAI,CAAC,MAAM,EAAE,KAAK;gBAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM;;gBAClD,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,MAAM,EAAE,KAAK;YACvC,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,IAAI;IAC5B,QAAA,CAAC,MAAM,EAAE,aAAa,IAAI,QAAQ,CAAC,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC;QACtE;IAEQ,IAAA,MAAM,SAAS,GAAA;;IAEnB,QAAA,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI,MAAM,CAAC,SAAS,GAAG,CAAC,CAAgC,KAAI;IAClF,YAAA,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI;IAC1B,gBAAA,OAAO,OAAO,CAAC,CAAC,CAAC;IACrB,QAAA,CAAC,CAAC;QACN;IAEA,IAAA,MAAM,KAAK,CAAC,GAAW,EAAE,GAAiB,EAAA;IACtC,QAAA,IAAI,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC;IAAE,YAAA,OAAO,IAAI;IAC1C,QAAA,MAAM,GAAG,GAAmB;gBACxB,GAAG;gBACH;aACH;YACD,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,WAAW,CAAC,GAAG,CAAC;IAC5C,QAAA,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,SAAS,EAAE;YAClC,OAAO,GAAG,CAAC,IAAI;QACnB;IACH;;;;;;;;;"}