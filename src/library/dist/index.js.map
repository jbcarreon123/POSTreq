{"version":3,"file":"index.js","sources":["../src/iframe.ts","../src/index.ts"],"sourcesContent":["import type { MessageRequest } from \"./shared.js\";\n\nexport class POSTreq_Iframe {\n    constructor() {\n        console.log('POSTreq loaded. https://postreq.jbc.lol/');\n        window.addEventListener('message', async (e) => {\n            if (!e.data.url) return;\n            const evt = e as MessageEvent<MessageRequest>;\n            let p = document.querySelector('p.debug');\n            if (p) p.textContent = JSON.stringify(evt);\n            try {\n                const data = evt.data as MessageRequest;\n                const res = await fetch(data.url, data.req);\n                const headers = {};\n                res.headers.forEach((value, name) => {\n                    //@ts-ignore\n                    headers[name] = value;\n                });\n\n                let json: string | undefined;\n                try {\n                    json = await res.clone().json();\n                } catch {}\n\n                let arrayBuffer: ArrayBuffer | undefined = undefined;\n                try {\n                    arrayBuffer = await res.clone().arrayBuffer()\n                } catch {}\n\n                let blob: Blob | undefined;\n                try {\n                    blob = await res.clone().blob();\n                } catch {}\n\n                let formData: FormData | undefined;\n                try {\n                    formData = await res.clone().formData();\n                } catch {}\n\n                let text: string | undefined;\n                try {\n                    text = await res.clone().text()\n                } catch {}\n\n                const payload = {\n                    status: res.status,\n                    statusText: res.statusText,\n                    headers: headers,\n                    json,\n                    arrayBuffer,\n                    formData,\n                    blob,\n                    text,\n                    ok: res.ok\n                };\n                if (p) p.textContent = JSON.stringify(payload);\n                evt.source?.postMessage(payload);\n            } catch (e) {\n                console.log(e);\n                evt.source?.postMessage({\n                    error: e\n                });\n            }\n        })\n    }\n}\n","import type { MessageRequest, MessageResponse } from \"./shared.js\";\nexport { POSTreq_Iframe } from './iframe.js';\n\nexport class POSTreq {\n    _iframe: HTMLIFrameElement;\n    _url?: string;\n\n    constructor(params?: {style?: string, url?: string, parentElement?: HTMLElement}) {\n        this._url = params?.url || \"https://postreq.jbc.lol/postreq\"; \n        this._iframe = document.createElement('iframe');\n        if (!params?.style) this._iframe.style.display = \"none\";\n        else this._iframe.style = params?.style;\n        this._iframe.src = this._url;\n        (params?.parentElement ?? document.body).appendChild(this._iframe);\n    }\n\n    private async onMessage(): Promise<MessageEvent<MessageResponse>> {\n        // @ts-ignore\n        return new Promise(resolve => window.onmessage = (e: MessageEvent<MessageResponse>) => {\n            if (e.origin !== this._url)\n            return resolve(e)\n        });\n    }\n\n    async fetch(url: string, req?: RequestInit): Promise<MessageResponse | null> {\n        if (url.includes('undefined')) return null;\n        const obj: MessageRequest = {\n            url,\n            req\n        }\n        this._iframe.contentWindow?.postMessage(obj);\n        const res = await this.onMessage();\n        return res.data;\n    }\n}"],"names":[],"mappings":"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"}